# Golden Path Configuration for Gemma 3 on GKE
image:
  repository: us-docker.pkg.dev/cloudrun/container/gemma/gemma3-4b
  tag: latest
  pullPolicy: IfNotPresent

resources:
  limits:
    nvidia.com/gpu: 1
    memory: "40Gi"
  requests:
    cpu: "8" 
    memory: "40Gi"

service:
  type: LoadBalancer
  port: 8000

env:
  OLLAMA_HOST: "0.0.0.0:8000"
  OLLAMA_KEEP_ALIVE: "-1"
  OLLAMA_MAX_LOADED_MODELS: "1"
  OLLAMA_NUM_PARALLEL: "4"

nodeSelector:
  cloud.google.com/gke-accelerator: nvidia-l4

tolerations:
- key: "nvidia.com/gpu"
  operator: "Exists"
  effect: "NoSchedule"
- key: "cloud.google.com/gke-queued"
  operator: "Equal"
  value: "true"
  effect: "NoSchedule"

autoscaling:
  enabled: true
  minReplicas: 1
  maxReplicas: 10
  # Aggressive scaling: Trigger scale-up at 40% CPU
  targetCPUUtilizationPercentage: 40
